# Users API â€” Register Endpoint

POST /users/register

**Description:**
- Create a new user account and return a JWT token plus the created user (password omitted).

**HTTP Method:** POST
**Path:** /users/register

**Request headers:**
- `Content-Type: application/json`

**Request body (JSON):**
- fullname: object
  - firstname: string (required, min 3 chars)
  - lastname: string (required, min 3 chars)
- email: string (required, valid email)
- password: string (required, min 6 chars)

Example request body:

```json
{
  "fullname": {
    "firstname": "Ashu",
    "lastname": "Kumar"
  },
  "email": "ashu@example.com",
  "password": "s3cr3tPass"
}
```

**Validation rules:**
- `email` must be a valid email address (returns 400 if invalid).
- `fullname.firstname` must be at least 3 characters (returns 400 if invalid).
- `password` must be at least 6 characters (returns 400 if invalid).
- All fields listed above are required; missing fields will cause an error.

**Responses:**

- 201 Created
  - Returned when user is successfully created.
  - Response body example:

```json
{
  "token": "<jwt-token-string>",
  "user": {
    "_id": "<user-id>",
    "fullname": {
      "firstname": "Ashu",
      "lastname": "Kumar"
    },
    "email": "ashu@example.com",
    "socketId": null
  }
}
```

- 400 Bad Request
  - Returned when validation fails (invalid email/short firstname or password) or required fields are missing.
  - Response body structure (example):

```json
{
  "errors": [
    {
      "msg": "Invalid Email",
      "param": "email",
      "location": "body"
    }
  ]
}
```

- 500 Internal Server Error
  - Returned when an unexpected server/database error occurs.

**Notes / Implementation details:**
- Endpoint is mounted under `/users` in the app, so route is `/users/register`.
- Passwords are hashed before being saved; the API response does not include the password.
- The endpoint returns a JWT generated by the server on success.

---

POST /users/login

**Description:**
- Authenticate a user using email and password. On success, returns a JWT token and the user object (password omitted).

**HTTP Method:** POST
**Path:** /users/login

**Request headers:**
- `Content-Type: application/json`

**Request body (JSON):**
- email: string (required, valid email)
- password: string (required, min 6 chars)

Example request body:

```json
{
  "email": "ashu@example.com",
  "password": "s3cr3tPass"
}
```

**Validation rules:**
- `email` must be a valid email address (returns 400 if invalid).
- `password` must be at least 6 characters (returns 400 if invalid).
- Both fields are required; missing fields will cause an error.

**Responses:**

- 200 OK
  - Returned when authentication succeeds.
  - Response body example:

```json
{
  "token": "<jwt-token-string>",
  "user": {
    "_id": "<user-id>",
    "fullname": {
      "firstname": "Ashu",
      "lastname": "Kumar"
    },
    "email": "ashu@example.com",
    "socketId": null
  }
}
```

- 400 Bad Request
  - Returned when validation fails (invalid email or short password) or required fields are missing.
  - Response body structure (example):

```json
{
  "errors": [
    {
      "msg": "Invalid Email",
      "param": "email",
      "location": "body"
    }
  ]
}
```

- 401 Unauthorized
  - Returned when email is not found or password does not match.
  - Response body example:

```json
{
  "message": "Invalid email or password"
}
```

- 500 Internal Server Error
  - Returned when an unexpected server/database error occurs.

**Notes / Implementation details:**
- Endpoint is mounted under `/users` in the app, so route is `/users/login`.
- On successful login the server includes a JWT; the password is never returned in responses.

---

GET /users/profile

**Description:**
- Return the currently authenticated user's profile. Requires a valid JWT (sent either as a cookie named `token` or in the `Authorization: Bearer <token>` header).

**HTTP Method:** GET
**Path:** /users/profile

**Request headers:**
- `Authorization: Bearer <jwt-token>` OR cookie `token=<jwt-token>`

**Responses:**

- 200 OK
  - Returned when the token is valid and the user is found.
  - Response body example:

```json
{
  "_id": "<user-id>",
  "fullname": {
    "firstname": "Ashu",
    "lastname": "Kumar"
  },
  "email": "ashu@example.com",
  "socketId": null
}
```

- 401 Unauthorized
  - Returned when no token is provided, the token is invalid, or the token is blacklisted.
  - Response body example:

```json
{
  "message": "Unauthorized"
}
```

- 500 Internal Server Error
  - Returned when an unexpected server/database error occurs.

**Notes / Implementation details:**
- This route is protected by the authentication middleware which checks for a blacklisted token and verifies the JWT.

---

GET /users/logout

**Description:**
- Log out the currently authenticated user by clearing the `token` cookie and adding the token to a blacklist so it cannot be reused.

**HTTP Method:** GET
**Path:** /users/logout

**Request headers:**
- `Authorization: Bearer <jwt-token>` OR cookie `token=<jwt-token>`

**Responses:**

- 200 OK
  - Returned when logout succeeds and the token is blacklisted.
  - Response body example:

```json
{
  "message": "logged out "
}
```

- 401 Unauthorized
  - Returned when no token is provided or the token is already invalid/blacklisted.

- 500 Internal Server Error
  - Returned when an unexpected server/database error occurs.

**Notes / Implementation details:**
- The logout endpoint clears the cookie named `token` and records the token in a `blacklistToken` collection so subsequent requests using the same token are rejected.

